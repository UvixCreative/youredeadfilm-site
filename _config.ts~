import lume from "lume/mod.ts";
import blog from "blog/mod.ts";
import * as fs from "node:fs";
import transformImages from "lume/plugins/transform_images.ts";

const site = lume({
    location: new URL("https://benrank.in"),
});

site.use(transformImages());
site.use(blog());

site.add("css");
site.add("assets");

let photography_categories = fs.readdirSync('./assets/photography/').sort().filter((item) => !isNaN(item[0]));
let photography_files = {};
photography_categories.forEach((dir) => photography_files[dir] = fs.readdirSync('./assets/photography/'+dir+'/').sort());
site.data("photography_categories", photography_categories);
site.data("photography_files", photography_files);

site.preprocess([".md"], (pages) => {
        for (const page of pages) {
          page.data.excerpt ??= (page.data.content as string).slice(0,300);
        }
});

export default site;
